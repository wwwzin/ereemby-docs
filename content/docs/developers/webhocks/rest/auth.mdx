---
title: Autenticacao
icon: Network 
description: P√°gina inicial da documenta√ß√£o
---

Para come√ßarmos a trabalhar com Webhooks REST e configurar um novo webhook na Ereemby, siga estes passos:

Os webhooks s√£o um meio essencial de comunica√ß√£o entre a Ereemby e o seu sistema. Para garantir que apenas mensagens leg√≠timas sejam processadas, utilizamos um m√©todo de autentica√ß√£o baseado em HMAC (Hash-based Message Authentication Code).

<Steps>
  <Step title="Gera√ß√£o do Token de Assinatura">
    Ereemby gera um token de assinatura baseado no conte√∫do do corpo da requisi√ß√£o (body) e em um segredo compartilhado (secure token) atribu√≠do a cada webhook no momento da sua cria√ß√£o.

    <ImageZoom 
      src="/docs/rest/auth.png" 
      alt="Autentica√ß√£o" 
      width={600} 
      height={600} 
    />
  </Step>

  <Step title="Token Gerado">
    Esse token √© um hash criptogr√°fico HMAC-SHA256, que √© enviado no cabe√ßalho da requisi√ß√£o:

    ```js
    x-webhook-signature: <token-gerado>
    ```
  </Step>

  <Step title="Verifica√ß√£o da Autenticidade">
    Ao receber o webhook, seu servidor precisa validar se a requisi√ß√£o veio realmente da Ereemby. Isso √© feito recriando o token HMAC localmente e comparando-o com o token recebido no cabe√ßalho. O c√≥digo abaixo faz essa verifica√ß√£o:

    ```js
    const crypto = require('crypto');

    // Fun√ß√£o para validar a assinatura do webhook
    function verifyToken(body, secret, receivedToken) {
        // Converte o corpo da requisi√ß√£o para JSON
        const payload = JSON.stringify(body);

        // Gera um token HMAC-SHA256 usando o secret
        const expectedToken = crypto
            .createHmac('sha256', secret)
            .update(payload)
            .digest('hex');

        // Compara o token gerado com o recebido na requisi√ß√£o
        return expectedToken === receivedToken;
    }
    ```
  </Step>

  <Step title="Aceitar ou Rejeitar o Webhook">
    No seu endpoint do webhook, a l√≥gica de valida√ß√£o √© aplicada para decidir se o webhook ser√° processado:

    ```js
    app.post('/webhook', (req, res) => {
        const body = req.body;
        const receivedToken = req.headers['x-webhook-signature'];

        // Verifica se o token foi enviado
        if (!receivedToken) {
            console.log('Token ausente');
            return res.status(401).json({ success: false, message: 'Token ausente' });
        }

        // Valida o token recebido
        const isValid = verifyToken(body, process.env.WEBHOOK_SECRET, receivedToken);

        if (!isValid) {
            return res.status(403).json({ success: false, message: 'Token inv√°lido' });
        }

        console.log('Webhook autenticado com sucesso:', body);
        res.json({ success: true, message: 'Webhook recebido e autenticado com sucesso' });
    });
    ```
  </Step>
</Steps>

## Por que essa autentica√ß√£o √© importante?

<Callout type="info">
üîπ Protege seu sistema contra requisi√ß√µes falsas (spoofing)  
üîπ Evita ataques do tipo "replay" e altera√ß√µes maliciosas nos dados  
üîπ Garante que apenas mensagens leg√≠timas da Ereemby sejam processadas  
</Callout>

üí° **Dica**: Sempre armazene o `WEBHOOK_SECRET` em vari√°veis de ambiente e nunca o exponha no c√≥digo!

